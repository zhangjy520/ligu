<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.gukeer.classcard.persistence.dao.A_ClassCardAppMapper">

    <select id="findAllClassCardAppView" resultType="cn.gukeer.classcard.modelView.ClassCardAppView">
    SELECT
        tcca.id,
        tcca.app_name appName,
        tcca.create_date createDate,
        su.name uploadPersion
    FROM
        teach_class_card_app tcca,
        sys_user su
    WHERE
        tcca.create_by = su.id
        <if test='appName !="" and appName !=null'>
            AND tcca.app_name  like   CONCAT('%',#{appName},'%')
        </if>
        AND tcca.del_flag = 0
        AND su.del_flag = 0
        AND tcca.school_id=#{schoolId}
        order by createDate desc
</select>
    <insert id="batchInsertClassCardAppRef" parameterType="java.util.List">
        insert into  teach_ref_classcard_app
            (id,class_card_id,class_card_app_id,school_id,create_date,create_by)
        values
        <foreach collection="classCardAppRefs" item="item" separator=",">
            (#{item.id},#{item.classCardId},#{item.classCardAppId},#{item.schoolId},#{item.createDate},#{item.createBy})
        </foreach>

    </insert>

    <select id="findClassCardByappId" resultType="cn.gukeer.classcard.modelView.ClassCardView">
        SELECT
            trca.create_date cardRefAppCreateDate,
            classroom,
            equipment_name equipmentName,
            mac_id macId,
            tcc.id,
            tcca.version_code versionCode,
            trca.feed_back_time feedBackTime,
            trca.feed_back_status feedBackStatus,
            trca.feed_back_remarks feedBackRemarks
        FROM
            teach_ref_classcard_app trca
                LEFT JOIN
            teach_class_card tcc ON tcc.id = trca.class_card_id
                 LEFT JOIN
            teach_class_card_app tcca ON tcca.id = trca.class_card_app_id
        WHERE
            trca.class_card_app_id = #{appId}
                AND tcc.school_id = #{schoolId}
        ORDER BY trca.feed_back_time DESC

    </select>

</mapper>